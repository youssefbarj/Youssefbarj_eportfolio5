import { useState, useEffect, useRef } from 'react'
import { motion, AnimatePresence, useAnimation } from 'framer-motion'
import { ChevronDown, Download, ExternalLink, Linkedin, Mail, Menu, X, ChevronRight } from 'lucide-react'

export default function Portfolio() {
  const [activeTab, setActiveTab] = useState('about')
  const [isMenuOpen, setIsMenuOpen] = useState(false)
  const [scrollY, setScrollY] = useState(0)
  const [activeSkill, setActiveSkill] = useState(null)
  const [expandedExperience, setExpandedExperience] = useState(null)
  const controls = useAnimation()
  const [isInView, setIsInView] = useState(false)
  const ref = useRef(null)

  useEffect(() => {
    const handleScroll = () => setScrollY(window.scrollY)
    window.addEventListener('scroll', handleScroll)
    return () => window.removeEventListener('scroll', handleScroll)
  }, [])

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        setIsInView(entry.isIntersecting)
      },
      { threshold: 0.1 }
    )

    if (ref.current) {
      observer.observe(ref.current)
    }

    return () => {
      if (ref.current) {
        observer.unobserve(ref.current)
      }
    }
  }, [ref])

  useEffect(() => {
    if (isInView) {
      controls.start('visible')
    }
  }, [controls, isInView])

  const fadeInUp = {
    initial: { opacity: 0, y: 60 },
    animate: { opacity: 1, y: 0 },
    transition: { duration: 0.6 }
  }

  const staggerChildren = {
    animate: {
      transition: {
        staggerChildren: 0.1
      }
    }
  }

  const navItems = ['About', 'Skills', 'Projects', 'Experience', 'Contact']

  const skills = [
    { name: 'Instructional Design', icon: 'üéì', description: 'Expert in creating effective learning experiences' },
    { name: 'E-Learning Development', icon: 'üíª', description: 'Proficient in developing interactive online courses' },
    { name: 'LMS Administration', icon: 'üñ•Ô∏è', description: 'Experienced in managing learning management systems' },
    { name: 'Project Management', icon: 'üìä', description: 'Skilled in coordinating and overseeing e-learning projects' },
    { name: 'Gamification', icon: 'üéÆ', description: 'Adept at incorporating game elements in learning' },
    { name: 'TICE & Digital Learning', icon: 'üì±', description: 'Knowledgeable in educational technology integration' },
    { name: 'Articulate 360', icon: 'üîß', description: 'Proficient in using Articulate 360 suite for course creation' },
    { name: 'Adobe Creative Suite', icon: 'üé®', description: 'Skilled in using Adobe tools for content creation' },
    { name: 'Moodle & Open edX', icon: 'üè´', description: 'Experienced with popular open-source LMS platforms' },
    { name: 'Video Editing', icon: 'üé¨', description: 'Capable of creating and editing educational videos' },
    { name: 'UX/UI Design', icon: 'üñåÔ∏è', description: 'Focused on creating user-friendly learning interfaces' },
    { name: 'HTML, CSS, PHP', icon: 'üåê', description: 'Proficient in web technologies for custom e-learning solutions' },
  ]

  const experiences = [
    {
      title: 'E-learning Project Manager and Learning Technology Expert',
      company: 'EMERA Priv√©e (Subsidiary of Dokeos LMS)',
      location: 'Casablanca, Morocco',
      period: '',
      description: 'Managed e-learning projects, provided client support, integrated LMS with third-party systems, and implemented IT security protocols. Expertise in Dokeos LMS, project management, systems integration, and technological monitoring.',
      details: [
        'Provided consultancy for custom e-learning projects in various industries',
        'Integrated Dokeos LMS with CRM and ERP systems',
        'Developed customized LMS features',
        'Implemented IT security protocols for the team'
      ]
    },
    {
      title: 'Freelance Instructional Designer',
      company: 'Various Clients',
      period: '2 years',
      description: 'Developed interactive e-learning modules using Articulate Rise, managing client relationships, feedback incorporation, and timely delivery within budget constraints.',
      details: [
        'Created 30-45 minute interactive e-learning experiences',
        'Incorporated various media types (PPT, PDF, MP4, URLs)',
        'Managed multiple rounds of review and feedback',
        'Published modules in web and SCORM formats'
      ]
    },
    {
      title: 'Training Manager',
      company: 'Tesselate',
      period: '6 months',
      description: 'Redesigned cybersecurity training, implemented LMS, and gamified onboarding trainings.',
      details: [
        'Overhauled existing cybersecurity training materials',
        'Successfully implemented a new Learning Management System',
        'Introduced gamification elements to onboarding process',
        'Increased employee engagement in training programs'
      ]
    },
    {
      title: 'E-Learning Designer',
      company: 'E-Learning Solutions Inc.',
      period: '3 months',
      description: 'Designed and developed a complete course using Articulate Rise 360.',
      details: [
        'Created a comprehensive e-learning course from scratch',
        'Utilized advanced features of Articulate Rise 360',
        'Collaborated with subject matter experts for content accuracy',
        'Implemented responsive design for multi-device compatibility'
      ]
    },
    {
      title: 'Instructional Designer',
      company: 'Startup HopeZ',
      period: '2 months',
      description: 'Redesigned online courses and implemented gamification.',
      details: [
        'Revamped existing online course structure and content',
        'Introduced gamification elements to increase user engagement',
        'Developed achievement and reward systems',
        'Improved course completion rates by 30%'
      ]
    },
    {
      title: 'Technopedagogy Project',
      company: 'Bruxelles Formation',
      period: '2 months',
      description: 'Created a quasi-chatbot for digital pedagogy topics.',
      details: [
        'Designed and developed an AI-powered chatbot',
        'Focused on digital pedagogy and educational technology topics',
        'Implemented natural language processing for user queries',
        'Integrated the chatbot with existing learning resources'
      ]
    },
  ]

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white font-sans">
      <header className={`py-4 px-4 sm:px-6 lg:px-8 fixed w-full z-50 transition-all duration-300 ${scrollY > 50 ? 'bg-gray-900/80 backdrop-blur-md' : ''}`}>
        <nav className="flex justify-between items-center max-w-7xl mx-auto">
          <motion.a 
            href="#" 
            className="text-3xl font-bold text-blue-400"
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.5 }}
          >
            YB
          </motion.a>
          <div className="hidden md:flex space-x-4">
            {navItems.map((item, index) => (
              <motion.button
                key={item}
                onClick={() => setActiveTab(item.toLowerCase())}
                className={`px-3 py-2 rounded-md text-sm font-medium ${
                  activeTab === item.toLowerCase() ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'
                }`}
                initial={{ opacity: 0, y: -20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
              >
                {item}
              </motion.button>
            ))}
          </div>
          <motion.button
            className="md:hidden text-white"
            onClick={() => setIsMenuOpen(!isMenuOpen)}
            initial={{ opacity: 0, x: 20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.5 }}
          >
            {isMenuOpen ? <X /> : <Menu />}
          </motion.button>
        </nav>
      </header>

      <AnimatePresence>
        {isMenuOpen && (
          <motion.div
            className="fixed inset-0 bg-gray-900 z-40 md:hidden"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
          >
            <div className="flex flex-col items-center justify-center h-full">
              {navItems.map((item, index) => (
                <motion.button
                  key={item}
                  onClick={() => {
                    setActiveTab(item.toLowerCase())
                    setIsMenuOpen(false)
                  }}
                  className={`px-3 py-2 rounded-md text-lg font-medium mb-4 ${
                    activeTab === item.toLowerCase() ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'
                  }`}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.3, delay: index * 0.1 }}
                >
                  {item}
                </motion.button>
              ))}
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      <main className="max-w-7xl mx-auto py-20 px-4 sm:px-6 lg:px-8">
        <AnimatePresence mode="wait">
          {activeTab === 'about' && (
            <motion.section
              key="about"
              initial="initial"
              animate="animate"
              exit="initial"
              variants={fadeInUp}
              className="text-center"
            >
              <motion.img
                src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/1691435719454-0cueSx5nLXL7zIjSLVprZCRVtJl6Hb.jpeg"
                alt="Youssef Barj"
                className="w-40 h-40 rounded-full mx-auto mb-8 border-4 border-blue-400"
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ type: "spring", stiffness: 260, damping: 20 }}
              />
              <motion.h1 
                className="text-5xl font-bold mb-4"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.2 }}
              >
                Youssef Barj
              </motion.h1>
              <motion.p 
                className="text-2xl text-blue-300 mb-8"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.3 }}
              >
                Innovative Instructional Designer & Digital Learning Engineer
              </motion.p>
              <motion.p 
                className="max-w-2xl mx-auto text-gray-300 mb-12 text-lg"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.4 }}
              >
                Passionate about creating engaging and effective learning experiences. With expertise in eLearning design,
                gamification, and LMS administration, I bring a unique blend of educational theory and technological innovation
                to every project.
              </motion.p>
              <motion.div 
                className="flex flex-wrap justify-center gap-4"
                variants={staggerChildren}
              >
                <motion.a
                  href="#"
                  className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full inline-flex items-center transition-colors duration-300"
                  variants={fadeInUp}
                >
                  <Download className="mr-2" />
                  Download CV
                </motion.a>
                <motion.a
                  href="#contact"
                  className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full inline-flex items-center transition-colors duration-300"
                  variants={fadeInUp}
                >
                  <Mail className="mr-2" />
                  Contact Me
                </motion.a>
              </motion.div>
            </motion.section>
          )}

          {activeTab === 'skills' && (
            <motion.section
              key="skills"
              initial="initial"
              animate="animate"
              exit="initial"
              variants={fadeInUp}
            >
              <h2 className="text-4xl font-bold mb-12 text-center">Skills & Expertise</h2>
              <motion.div 
                className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
                variants={staggerChildren}
              >
                {skills.map((skill) => (
                  <motion.div
                    key={skill.name}
                    className={`bg-gray-800 p-6 rounded-lg text-center hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105 cursor-pointer ${activeSkill === skill.name ? 'bg-blue-700' : ''}`}
                    variants={fadeInUp}
                    onClick={() => setActiveSkill(activeSkill === skill.name ? null : skill.name)}
                  >
                    <span className="text-4xl mb-4 block">{skill.icon}</span>
                    <h3 className="font-medium text-lg">{skill.name}</h3>
                    <AnimatePresence>
                      {activeSkill === skill.name && (
                        <motion.p
                          initial={{ opacity: 0, height: 0 }}
                          animate={{ opacity: 1, height: 'auto' }}
                          exit={{ opacity: 0, height: 0 }}
                          transition={{ duration: 0.3 }}
                          className="mt-2 text-sm"
                        >
                          {skill.description}
                        </motion.p>
                      )}
                    </AnimatePresence>
                  </motion.div>
                ))}
              </motion.div>
            </motion.section>
          )}

          {activeTab ===   'projects' && (
            <motion.section
              key="projects"
              initial="initial"
              animate="animate"
              exit="initial"
              variants={fadeInUp}
            >
              <h2 className="text-4xl font-bold mb-12 text-center">Featured Projects</h2>
              <motion.div 
                className="grid md:grid-cols-2 lg:grid-cols-3 gap-8"
                variants={staggerChildren}
              >
                {[
                  {
                    title: 'Gamified Cybersecurity Training',
                    description: 'Interactive course designed to enhance cybersecurity awareness through gamification for Tesselate.',
                    image: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/1520078765767-0cueSx5nLXL7zIjSLVprZCRVtJl6Hb.jpg',
                    link: '#'
                  },
                  {
                    title: 'Privacy and Personal Data',
                    description: 'Interactive eLearning course on privacy rights and data protection in the financial industry.',
                    image: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-3-0cueSx5nLXL7zIjSLVprZCRVtJl6Hb.jpg',
                    link: 'https://360.articulate.com/review/content/2dd43c56-b591-4ca0-a4a3-562102b4ebaa/review'
                  },
                  {
                    title: 'Data Security Threats: Phishing',
                    description: 'eLearning course on recognizing and mitigating phishing attempts in email communication.',
                    image: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/phishing-2-0cueSx5nLXL7zIjSLVprZCRVtJl6Hb.jpg',
                    link: 'https://360.articulate.com/review/content/aad4cbee-a70f-4cab-bd56-c2ecafeaf98b/review'
                  },
                ].map((project) => (
                  <motion.div
                    key={project.title}
                    className="bg-gray-800 rounded-lg overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300"
                    variants={fadeInUp}
                  >
                    <img src={project.image} alt={project.title} className="w-full h-48 object-cover" />
                    <div className="p-6">
                      <h3 className="font-bold text-xl mb-3 text-blue-300">{project.title}</h3>
                      <p className="text-gray-400 mb-6">{project.description}</p>
                      <a
                        href={project.link}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full inline-flex items-center transition-colors duration-300"
                      >
                        <ExternalLink className="mr-2" />
                        View Project
                      </a>
                    </div>
                  </motion.div>
                ))}
              </motion.div>
            </motion.section>
          )}

          {activeTab === 'experience' && (
            <motion.section
              key="experience"
              initial="initial"
              animate="animate"
              exit="initial"
              variants={fadeInUp}
            >
              <h2 className="text-4xl font-bold mb-12 text-center">Professional Experience</h2>
              <motion.div 
                className="space-y-8"
                variants={staggerChildren}
              >
                {experiences.map((exp, index) => (
                  <motion.div
                    key={index}
                    className="bg-gray-800 p-8 rounded-lg shadow-lg transform hover:scale-105 transition-transform duration-300"
                    variants={fadeInUp}
                  >
                    <h3 className="text-2xl font-bold mb-3 text-blue-300">{exp.title}</h3>
                    <p className="text-xl text-gray-400 mb-3">{exp.company}</p>
                    <p className="text-gray-500 mb-4">{exp.period}</p>
                    <p className="text-gray-300 text-lg mb-4">{exp.description}</p>
                    <button
                      onClick={() => setExpandedExperience(expandedExperience === index ? null : index)}
                      className="text-blue-400 hover:text-blue-300 transition-colors duration-300 flex items-center"
                    >
                      {expandedExperience === index ? 'Hide Details' : 'Show Details'}
                      <ChevronRight className={`ml-2 transform transition-transform duration-300 ${expandedExperience === index ? 'rotate-90' : ''}`} />
                    </button>
                    <AnimatePresence>
                      {expandedExperience === index && (
                        <motion.ul
                          initial={{ opacity: 0, height: 0 }}
                          animate={{ opacity: 1, height: 'auto' }}
                          exit={{ opacity: 0, height: 0 }}
                          transition={{ duration: 0.3 }}
                          className="mt-4 space-y-2"
                        >
                          {exp.details.map((detail, i) => (
                            <motion.li
                              key={i}
                              initial={{ opacity: 0, x: -20 }}
                              animate={{ opacity: 1, x: 0 }}
                              transition={{ delay: i * 0.1 }}
                              className="flex items-start"
                            >
                              <ChevronRight className="mr-2 mt-1 text-blue-400" />
                              <span>{detail}</span>
                            </motion.li>
                          ))}
                        </motion.ul>
                      )}
                    </AnimatePresence>
                  </motion.div>
                ))}
              </motion.div>
            </motion.section>
          )}

          {activeTab === 'contact' && (
            <motion.section
              key="contact"
              initial="initial"
              animate="animate"
              exit="initial"
              variants={fadeInUp}
              className="text-center"
            >
              <h2 className="text-4xl font-bold mb-8">Let's Connect</h2>
              <motion.p 
                className="mb-12 text-2xl text-gray-300"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.2 }}
              >
                Ready to create innovative learning experiences? Get in touch!
              </motion.p>
              <motion.div 
                className="flex flex-wrap justify-center gap-6"
                variants={staggerChildren}
              >
                <motion.a
                  href="mailto:barjyoussef5@gmail.com"
                  className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full inline-flex items-center transition-colors duration-300"
                  variants={fadeInUp}
                >
                  <Mail className="mr-2" />
                  Email Me
                </motion.a>
                <motion.a
                  href="https://www.linkedin.com/in/youssefbarj"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full inline-flex items-center transition-colors duration-300"
                  variants={fadeInUp}
                >
                  <Linkedin className="mr-2" />
                  LinkedIn
                </motion.a>
              </motion.div>
            </motion.section>
          )}
        </AnimatePresence>
      </main>

      <footer className="bg-gray-900 py-8 mt-20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400">
          <p>&copy; 2023 Youssef Barj. All rights reserved.</p>
        </div>
      </footer>
    </div>
  )
}
